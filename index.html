<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sonsuza Dek Biz | 03.04.2025</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;600&family=Dancing+Script:wght@700&display=swap');
        
        body { margin: 0; background: #0f0f0f; color: #fff; font-family: 'Poppins', sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; touch-action: none; }
        
        #login-screen, #start-screen, #clip-container, #note-screen, #menu-screen { 
            text-align: center; padding: 20px; background: rgba(25, 25, 25, 0.98); border-radius: 35px; 
            border: 1px solid #ff4081; box-shadow: 0 0 40px rgba(255, 64, 129, 0.2); 
            width: 95%; max-width: 800px; transition: all 0.5s ease; box-sizing: border-box; position: absolute; 
        }

        #start-screen, #clip-container, #note-screen, #menu-screen { display: none; }

        .milat-baslik { font-family: 'Dancing Script', cursive; font-size: 2.5rem; color: #ff4081; margin-bottom: 10px; display: block; }
        #timer { font-size: 1.2rem; color: #ff80ab; font-weight: 600; display: block; margin-top: 10px; }

        .media-box { width: 100%; height: 350px; background: #000; border-radius: 20px; display: flex; justify-content: center; align-items: center; overflow: hidden; border: 2px solid #222; position: relative; }
        .myMedia { display: none; max-width: 100%; max-height: 100%; object-fit: contain; animation: sinematikGecis 1.2s ease-in-out; }

        @keyframes sinematikGecis { from { opacity: 0; transform: scale(1.05); } to { opacity: 1; transform: scale(1); } }

        .text-area { margin-top: 15px; min-height: 60px; font-size: 1.1rem; color: #ff80ab; font-style: italic; }

        .heart-btn { background: #ff4081; color: white; border: none; padding: 12px 25px; border-radius: 50px; cursor: pointer; font-size: 1rem; font-weight: 600; box-shadow: 0 5px 15px rgba(255, 64, 129, 0.3); transition: 0.3s; margin: 5px; }
        .heart-btn:hover { transform: scale(1.05); background: #ff1f6d; }

        /* √áizim Alanƒ± Tasarƒ±mƒ± */
        #canvas-container { background: #fff; border-radius: 15px; margin: 10px auto; width: 100%; max-width: 500px; height: 200px; position: relative; cursor: crosshair; touch-action: none; }
        #noteCanvas { width: 100%; height: 100%; border-radius: 15px; }

        input, textarea { background: #1a1a1a; border: 1px solid #ff4081; color: white; padding: 12px; border-radius: 15px; width: 90%; text-align: center; margin-bottom: 10px; font-family: inherit; }
        textarea { height: 60px; resize: none; }

        #notes-list { max-height: 150px; overflow-y: auto; margin-top: 15px; padding: 10px; }
        .note-item { background: rgba(255, 64, 129, 0.1); padding: 10px; border-radius: 10px; margin-bottom: 10px; border-left: 4px solid #ff4081; text-align: left; }
        .note-img { max-width: 100%; border-radius: 5px; margin-top: 5px; background: white; }
        
        .menu-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px; }
    </style>
</head>
<body>

    <div id="login-screen">
        <h2 style="font-family: 'Dancing Script', cursive; font-size: 2.5rem; margin-bottom: 20px;">Kalbimin Anahtarƒ±? ‚ù§Ô∏è</h2>
        <input type="password" id="passInput" placeholder="Sadece Bize √ñzel ≈ûifre...">
        <br>
        <button class="heart-btn" onclick="checkPassword()">Kapƒ±yƒ± Arala</button>
    </div>

    <div id="menu-screen">
        <h2 class="milat-baslik">Bizim D√ºnyamƒ±z</h2>
        <div class="menu-grid">
            <button class="heart-btn" onclick="startStory()">Anƒ±larƒ±mƒ±z üì∏</button>
            <button class="heart-btn" onclick="openNoteScreen()">A≈ük Notlarƒ± üìù</button>
        </div>
        <div id="timer" style="margin-top: 30px;"></div>
    </div>

    <div id="start-screen">
        <span class="milat-baslik">Yolculuƒüumuz...</span>
        <span id="timer-main"></span>
        <br><br>
        <button class="heart-btn" onclick="startStory()">Anƒ±larƒ±mƒ±za Yolculuk ‚ú®</button>
    </div>

    <div id="clip-container">
        <div class="media-box">
            <img src="resim1.jpeg" class="myMedia">
            <img src="resim2.jpeg" class="myMedia">
            <video class="myMedia" id="myVid" playsinline muted><source src="video.mp4" type="video/mp4"></video>
            <img src="resim3.jpeg" class="myMedia">
        </div>
        <div id="message-text" class="text-area"></div>
        <audio id="mainMusic" src="muzik.mp3" loop></audio>
    </div>

    <div id="note-screen">
        <h2 class="milat-baslik" style="font-size: 1.8rem;">Geleceƒüimize ƒ∞z Bƒ±rak</h2>
        <textarea id="noteInput" placeholder="Yazƒ±nƒ± buraya yaz sevgilim..."></textarea>
        <p style="font-size: 0.8rem; margin: 5px; color: #ff80ab;">A≈üaƒüƒ±ya kalbini √ßizebilirsin...</p>
        <div id="canvas-container">
            <canvas id="noteCanvas"></canvas>
        </div>
        <button class="heart-btn" onclick="clearCanvas()" style="background: #555; padding: 5px 15px; font-size: 0.8rem;">√áizimi Sil</button>
        <br>
        <button class="heart-btn" onclick="saveNote()">Sonsuza Dek Kaydet ‚ù§Ô∏è</button>
        <button class="heart-btn" onclick="backToPrev()" style="background: #333;">Geri</button>
        <div id="notes-list"></div>
    </div>

    <script>
        const TANI≈ûMA_TARƒ∞Hƒ∞ = "2025-04-03"; 
        const mesajlar = [
            "Hen√ºz birbirimizden habersizken bile kalplerimiz bu g√ºn i√ßin atƒ±yormu≈ü...",
            "Zamanƒ±n durmasƒ±nƒ± istediƒüim binlerce andan sadece biri...",
            "T√ºm dileklerinin ger√ßek olduƒüu, hayallerimizle s√ºsl√º nice mutlu senelerimize √∂mr√ºmmmmm:)"
        ];

        let currentIndex = 0;
        const mainMusic = document.getElementById('mainMusic');
        const canvas = document.getElementById('noteCanvas');
        const ctx = canvas.getContext('2d');
        let drawing = false;

        // ≈ûifre kontrol ve ba≈ülangƒ±√ß
        function checkPassword() {
            if(document.getElementById('passInput').value === "2240") {
                document.getElementById('login-screen').style.display = 'none';
                
                // Eƒüer daha √∂nce not kaydedilmi≈üse men√ºye, yoksa sayaca git
                if(localStorage.getItem('ask_notlari')) {
                    document.getElementById('menu-screen').style.display = 'block';
                } else {
                    document.getElementById('start-screen').style.display = 'block';
                }
                
                updateTimer();
                setInterval(updateTimer, 1000);
                initCanvas();
            } else { alert("Hatalƒ± ≈üifre hayatƒ±m!"); }
        }

        // Saya√ß G√ºncelleme
        function updateTimer() {
            const diff = new Date() - new Date(TANI≈ûMA_TARƒ∞Hƒ∞);
            const days = Math.floor(diff / 86400000);
            const hours = Math.floor((diff % 86400000) / 3600000);
            const mins = Math.floor((diff % 3600000) / 60000);
            const secs = Math.floor((diff % 60000) / 1000);
            const text = `${days} G√ºn, ${hours}:${mins}:${secs}`;
            if(document.getElementById('timer-main')) document.getElementById('timer-main').innerText = text;
            if(document.getElementById('timer')) document.getElementById('timer').innerText = text;
        }

        // Slayt Ba≈ülatma
        function startStory() {
            document.getElementById('start-screen').style.display = 'none';
            document.getElementById('menu-screen').style.display = 'none';
            document.getElementById('clip-container').style.display = 'block';
            currentIndex = 0;
            mainMusic.play();
            showNext();
            confetti({ particleCount: 100, spread: 70 });
        }

        function showNext() {
            let media = document.getElementsByClassName("myMedia");
            let textDiv = document.getElementById("message-text");

            if (currentIndex >= media.length) {
                textDiv.innerHTML = `<button class='heart-btn' onclick='openNoteScreen()'>Geleceƒüe Not Bƒ±rak</button>`;
                return;
            }

            for (let m of media) { m.style.display = "none"; if(m.tagName === "VIDEO") m.pause(); }

            let currentItem = media[currentIndex];
            currentItem.style.display = "block";
            textDiv.innerHTML = mesajlar[currentIndex] || "Seni Seviyorum...";
            currentIndex++;

            if (currentItem.tagName === "VIDEO") {
                currentItem.currentTime = 0; currentItem.play();
                currentItem.onended = () => showNext();
            } else {
                setTimeout(showNext, 4000); 
            }
        }

        // √áizim Fonksiyonlarƒ±
        function initCanvas() {
            const container = document.getElementById('canvas-container');
            canvas.width = container.offsetWidth;
            canvas.height = container.offsetHeight;
            ctx.strokeStyle = "#ff4081";
            ctx.lineWidth = 3;
            ctx.lineCap = "round";

            const startDraw = (e) => { drawing = true; draw(e); };
            const stopDraw = () => { drawing = false; ctx.beginPath(); };
            const draw = (e) => {
                if (!drawing) return;
                const rect = canvas.getBoundingClientRect();
                const x = (e.clientX || e.touches[0].clientX) - rect.left;
                const y = (e.clientY || e.touches[0].clientY) - rect.top;
                ctx.lineTo(x, y);
                ctx.stroke();
                ctx.beginPath();
                ctx.moveTo(x, y);
            };

            canvas.addEventListener('mousedown', startDraw);
            canvas.addEventListener('mousemove', draw);
            window.addEventListener('mouseup', stopDraw);
            canvas.addEventListener('touchstart', startDraw);
            canvas.addEventListener('touchmove', draw);
            canvas.addEventListener('touchend', stopDraw);
        }

        function clearCanvas() { ctx.clearRect(0, 0, canvas.width, canvas.height); }

        function openNoteScreen() {
            document.getElementById('clip-container').style.display = 'none';
            document.getElementById('menu-screen').style.display = 'none';
            document.getElementById('note-screen').style.display = 'block';
            displayNotes();
            setTimeout(initCanvas, 100);
        }

        function saveNote() {
            const text = document.getElementById('noteInput').value;
            const drawingData = canvas.toDataURL(); // √áizimi resim olarak al
            
            // √áizim bo≈ü mu kontrol√º (basit bir kontrol)
            const isCanvasEmpty = ctx.getImageData(0,0,canvas.width,canvas.height).data.every(p => p === 0);

            if(!text.trim() && isCanvasEmpty) return alert("Bo≈ü not bƒ±rakamazsƒ±n sevgilim...");

            const notes = JSON.parse(localStorage.getItem('ask_notlari') || "[]");
            notes.unshift({ text, image: drawingData, date: new Date().toLocaleString('tr-TR') });
            localStorage.setItem('ask_notlari', JSON.stringify(notes));
            
            alert("Notun kalbime kaydedildi!");
            document.getElementById('noteInput').value = "";
            clearCanvas();
            location.reload(); // ƒ∞lk nottan sonra men√ºye ge√ßi≈ü i√ßin sayfayƒ± yenile
        }

        function displayNotes() {
            const notes = JSON.parse(localStorage.getItem('ask_notlari') || "[]");
            document.getElementById('notes-list').innerHTML = notes.map(n => `
                <div class="note-item">
                    <small style="color:#ff80ab">${n.date}</small><br>
                    ${n.text ? `<div>${n.text}</div>` : ''}
                    <img src="${n.image}" class="note-img">
                </div>
            `).join('');
        }

        function backToPrev() {
            if(localStorage.getItem('ask_notlari')) {
                document.getElementById('note-screen').style.display = 'none';
                document.getElementById('menu-screen').style.display = 'block';
            } else {
                location.reload();
            }
        }
    </script>
</body>
</html>
